<div class="main-container">
  <app-item-filter (filtersChange)="onFiltersChange($event)"></app-item-filter>

  <div class="results-card">
    @if (dataSource.isLoading$ | async) {
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    } 
    
    @if (activeFilterChips.length > 0){
    <div class="active-filters">
      <span class="active-filters-label">Active filters:</span>
    </div>

    <mat-chip-set>
      @for (chip of activeFilterChips; track chip.label + chip.value) {
      <mat-chip>{{ chip.label }}: {{ chip.value }}</mat-chip>
      }
    </mat-chip-set>
    }

    <table mat-table matSort [dataSource]="dataSource">
      @for (column of displayedColumns; track column) {
      <ng-container [matColumnDef]="column">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          {{ column | titlecase }}
        </th>
        <td mat-cell *matCellDef="let item">{{ item[column] }}</td>
      </ng-container>
      }

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <mat-paginator
      [length]="(dataSource.totalItems$ | async) ?? 0"
      [pageSize]="query.size"
      [pageIndex]="query.page"
      [pageSizeOptions]="[3, 5, 10, 25]"
      showFirstLastButtons
    >
    </mat-paginator>
  </div>
</div>
